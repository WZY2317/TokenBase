#!/bin/bash
# ä¸€é”®æ›´æ–°æ‰€æœ‰æ•°æ®
# ä¾æ¬¡è·å–äº¤æ˜“æ‰€æ•°æ®ã€ç”Ÿæˆç²¾ç¡®åŒ¹é…ã€ç”Ÿæˆæ¨¡ç³ŠåŒ¹é…

set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
cd "$SCRIPT_DIR"

echo "=========================================="
echo "å¼€å§‹æ›´æ–°æ‰€æœ‰æ•°æ®..."
echo "=========================================="
echo ""

# æ­¥éª¤1: æ›´æ–°äº¤æ˜“æ‰€æ•°æ®ï¼ˆ7ä¸ªè¡¨ï¼‰
echo "ğŸ“¡ æ­¥éª¤1: è·å–äº¤æ˜“æ‰€æ•°æ®..."
echo "=========================================="
python3 main.py
echo ""

# æ­¥éª¤2: ç”Ÿæˆç²¾ç¡®åŒ¹é…æ˜ å°„ï¼ˆpair_mappingsï¼‰
echo "ğŸ”— æ­¥éª¤2: ç”Ÿæˆç²¾ç¡®åŒ¹é…æ˜ å°„..."
echo "=========================================="
python3 generate_mappings.py
echo ""

# æ­¥éª¤3: ç”Ÿæˆæ¨¡ç³ŠåŒ¹é…æ˜ å°„ï¼ˆfuzzy_pair_mappingsï¼‰
echo "ğŸ” æ­¥éª¤3: ç”Ÿæˆæ¨¡ç³ŠåŒ¹é…æ˜ å°„..."
echo "=========================================="
python3 fuzzy_match.py
echo ""

echo "=========================================="
echo "âœ… æ‰€æœ‰æ•°æ®æ›´æ–°å®Œæˆï¼"
echo "=========================================="
echo ""
echo "å·²æ›´æ–°çš„è¡¨ï¼š"
echo "  - 7ä¸ªäº¤æ˜“æ‰€è¡¨: binance/xt/okx/bybit/gate/kucoin/mexc_perpetual"
echo "  - pair_mappings (ç²¾ç¡®åŒ¹é…)"
echo "  - fuzzy_pair_mappings (æ¨¡ç³ŠåŒ¹é…)"
echo ""
echo "æç¤º: å¦‚éœ€è¿ç§»åˆ°ç»Ÿä¸€æ˜ å°„è¡¨ï¼Œè¯·è¿è¡Œï¼š"
echo "  cd database && psql -U oliver -d perpetual_contracts_raw -f migrate_to_unified_mappings.sql"
echo ""
